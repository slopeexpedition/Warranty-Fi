<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Schedule Visits</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/landingassets/css/main.css" />
</head>

<body>
	<div id="page-wrapper">
		<div id="header">
			<!-- Nav -->
			<nav id="nav" style="margin-top: -57px;">
				<ul>
					<li><a href="WarrantyFi.html">Home</a></li>
					<li>
						<a href="#" class="icon solid fa-angle-down"> Manufacturers</a>
						<ul>
							<li><a href="WarrantyFi_Manufacturers.html">Manage Manufacturers</a></li>
							<li><a href="WarrantyFi_Products.html">Manage Products</a></li>
						</ul>
					</li>
					<li class="current">
						<a href="#" class="icon solid fa-angle-down"> Visits</a>
						<ul>
							<li><a href="WarrantyFi_ManageVisits.html">Manage Visits</a></li>
							<li><a href="WarrantyFi_ScheduleVisits.html">Schedule Visits</a></li>
						</ul>
					</li>

					<li><a href="WarrantyFi_ExtendWarranty.html">Extend/Pre-Closure Warranty</a></li>
          <li><a href="Contact.html">Contact</a></li>
					<!-- <li><a href="#" class="button">Sign In</a></li> -->
				</ul>
			</nav>

		</div>
	</div>
	<label style="margin-left:29px;margin-top:29px;"><b>Pin the details to get Warranty Visit Details</b></label>
	<form id="searchForm" style="width: 50%;margin-left: 29px;margin-top: 2%;"></form>

	<div class="modal fade" id="exampleModal"  tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Fill Supplier Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="refundForm" style="display: none;"></form>
					<form id="paymentForm" style="display: none;"></form>
					<form id="updateForm" style="display: none;"></form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>

				</div>
			</div>
		</div>
	</div>

	<div id="res" class="alert"></div>
	<div class="row">
		<div id="spinner" style="display:none;position: relative; text-align: center; top: 100px;"><img
				src="images/Landing.jpg" style="width:20px;" /></div>
		<div id="Grid" class="mt-3" style="margin-left: 13px;margin-right: -16px;">
		</div>
		<br />
		<br />
		<hr />
	</div>
	<br />
	<div class="row" style="text-align:center">
		<div id="RouteDialog" style="text-align: left; display: none; margin-left: 30px;">
			<br />
			Select # of appointments per day :
			<br />
			<br />
			Day 1: <input type="text" style="width:40px" id="Day1Appointments" value="3">
			&nbsp;&nbsp;&nbsp;
			Day 2: <input type="text" style="width:40px" id="Day2Appointments" value="4">
			&nbsp;&nbsp;&nbsp;
			Day 3: <input type="text" style="width: 40px" id="Day3Appointments" value="2">
			&nbsp;&nbsp;&nbsp;
			Day 4: <input type="text" style="width: 40px" id="Day4Appointments" value="1">
			&nbsp;&nbsp;&nbsp;
			<br />
			<br />
			<button id="markerdisplay" class="btn btn-secondary">Show Map Locations</button> &nbsp; &nbsp; &nbsp;
			<button class="btn btn-secondary"><a href="WarrantyFi_RouteMaps.html" target="_blank">
				Initiate Optimal Routing

			</a>
		</button>
			<!--<button id="routedisplay" class="btn btn-secondary" onClick="location.href='RouteMaps.html'" target="_blank">>Initiate Optimal Routing..</button>-->
			<br />
			<br />
		</div>
		<br />
		<br />
		<br />
		<br />
	</div>

	<div id="MapRouter" style="width:800px;display: none;height:600px">
		<p>Optimal Route will be loaded here once Agent Addresses are picked up..</p>
	</div>
	<!-- Scripts -->

	<script src="https://storage.googleapis.com/chart-api-db/assets/js/jquery.min.js"></script>
	<script src="https://storage.googleapis.com/chart-api-db/assets/js/jquery.dropotron.min.js"></script>
	<script src="https://storage.googleapis.com/chart-api-db/assets/js/jquery.scrollex.min.js"></script>
	<script src="https://storage.googleapis.com/chart-api-db/assets/js/browser.min.js"></script>
	<script src="https://storage.googleapis.com/chart-api-db/assets/js/breakpoints.min.js"></script>
	<script src="https://storage.googleapis.com/chart-api-db/assets/js/util.js"></script>
	<script src="https://storage.googleapis.com/chart-api-db/assets/js/main.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

	<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" /> -->
	<script type="text/javascript" src="https://storage.googleapis.com/chart-api-db/CDN/deps/underscore.js"></script>
	<script type="text/javascript" src="https://storage.googleapis.com/chart-api-db/CDN/deps/opt/jsv.js"></script>
	<script type="text/javascript" src="https://storage.googleapis.com/chart-api-db/CDN/lib/jsonform.js"></script>
	<script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js" type="text/javascript"></script>
	<link href="https://cdn.syncfusion.com/ej2/material.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuidv4.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
		crossorigin="anonymous"></script>

	<!-- <link rel="stylesheet" type="text/css"
		href="https://storage.googleapis.com/chart-api-db/AppointmentAssets/JSONForm/deps/opt/bootstrap.css" />
	<link rel="stylesheet" type="text/css"
		href="https://storage.googleapis.com/chart-api-db/AppointmentAssets/JSONForm/deps/opt/bootstrap-wysihtml5.css" />
	<link rel="stylesheet" type="text/css"
		href="https://storage.googleapis.com/chart-api-db/AppointmentAssets/JSONForm/deps/opt/spectrum.css" />

	<script type="text/javascript"
		src="https://storage.googleapis.com/chart-api-db/AppointmentAssets/JSONForm/deps/jquery.min.js"></script> -->


	<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" /> -->
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<!-- <script src="https://ej2.syncfusion.com/javascript/demos/grid/grid-overview/datasource.js"
		type="text/javascript"></script> -->

	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&v=weekly"
		async defer></script>
	<script type="text/javascript">
		var start_date = "";
		var end_date = "";
		function popitup(url) {
			newwindow = window.open(url, 'name', 'height=600,width=800');
			if (window.focus) { newwindow.focus() }
			return false;
		}

		function httpGet(theUrl) {

			let xmlhttp;

			if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
				xmlhttp = new XMLHttpRequest();
			} else { // code for IE6, IE5
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}

			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					return xmlhttp.responseText;
				}
			}
			xmlhttp.open("GET", theUrl, false);
			xmlhttp.send();

			return xmlhttp.response;
		}

		//Create multiple Appointments by selecting + and - buttons
		$('#searchForm').jsonForm({
			"schema": {
				"StartDate": {
					"title": "Enter start date for appointments :",
					default: "2022-08-04",
					"type": "string",
					"required": true
				},
				"EndDate": {
					"title": "Enter planned date for completion :",
					default: "2022-08-07",
					"type": "string",
					"required": true
				},
				"Assignee": {
					"type": "string",
					default: "Ahmed",
					"title": "Assignee :",
					"enum": ["--Select--", "Ahmed", "Raju", "Ravi", "Monu", "Mahesh", "Vihaan", "Ayaan", "Anvesh", "Alok", "Ram", "Joseph"],
					"description": "Select Agent to get Appointments and Map the Route"
				}
			},
			"form": [
				{
					"key": "StartDate",
					"type": "date"
				},
				{
					"key": "EndDate",
					"type": "date"
				},
				{
					"key": "Assignee"
				},
				{
					"type": "actions",
					"items": [
						{
							"type": "submit",
							"title": "Submit"
						}
					]
				}
			],
			onSubmit: function (errors, values) {
				debugger
				if (errors) {
					$('#res').html('<p>Please fill required fields!</p>');
				}
				else {
					$("#spinner").show();

					var queries = [];
					var selObj = {}
					selObj.type = "GetRouteDetails";
					selObj.bucketName = "chart-api-db";
					selObj.dbName = "SchedulingRouting.db";
					selObj.tabName = "Appointments";
					selObj.StartDate = values.StartDate;
					selObj.EndDate = values.EndDate;
					selObj.Assignee = values.Assignee;
					selObj.queries = [];
					var qry = 'select * from Appointments where Date between ' + "'" + values.StartDate + "'" + ' and ' + "'" + values.EndDate + "'" + ' and Assignee = ' + "'" + values.Assignee + "'"
					// alert(qry);
					queries.push('select * from Appointments where Date between ' + "'" + values.StartDate + "'" + ' and ' + "'" + values.EndDate + "'" + ' and Assignee = ' + "'" + values.Assignee + "'");
					start_date = values.StartDate;
					end_date = values.EndDate;
					selObj.queries = queries;
					var data = JSON.parse(httpGet("https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(selObj)));

					var grid = new ej.grids.Grid({
						dataSource: data,
						allowSelection: true,
            allowFiltering: true,
            allowTextWrap: true,
            allowSorting: true,
            allowPaging: true,
            enableVirtualization: true,
            toolbar: ['Search'],
            filterSettings: { type: 'Menu' },
            selectionSettings: { persistSelection: true, type: "Multiple", checkboxOnly: true },
            enableHover: false,
            enableHeaderFocus: true,
            pageSettings: { pageCount: 4, pageSizes: true },
            height: 400,
            rowHeight: 38,
						columns: [
							{ field: 'ID', headerText: 'ID' },
							{ field: 'Date', headerText: 'Date' },
							{ field: 'Status', headerText: 'Status' },
							{ field: 'Name', headerText: 'Customer Name'},
							{ field: 'Address', headerText: 'Address' },
							{ field: 'Purpose', headerText: 'Purpose' },
							{ field: 'Assignee', headerText: 'Assignee' },
							{ field: 'Amount', headerText: 'Amount' },
							{
								headerText: 'Action',
								commands: [{ type: 'Edit', buttonOption: { iconCss: ' e-icons e-edit', cssClass: 'e-flat' } },
								{ type: 'Pay/Refund', buttonOption: { iconCss: ' e-icons e-eye', cssClass: 'e-flat', visible: false } },
									// { type: 'Extend/Reduce Warranty', buttonOption: { iconCss: ' e-icons e-hyperlink-open', cssClass: 'e-flat', visible: false } }
								]
							}
						],
						commandClick: (args) => {
							debugger

							//handleUpdateFeedback();


							var id = `${args.rowData.ID}`;
							var date = `${args.rowData.Date}`;
							var status = `${args.rowData.Status}`;

							var name = `${args.rowData.Name}`;
							var address = `${args.rowData.Address}`;
							var purpose = `${args.rowData.Purpose}`;
							var assignee = `${args.rowData.Assignee}`;
							var amount = `${args.rowData.Amount}`;
							localStorage.setItem("id", id);
							localStorage.setItem("date", date);
							localStorage.setItem("status", status);
							localStorage.setItem("name", name);
							localStorage.setItem("address", address);
							localStorage.setItem("purpose", purpose);
							localStorage.setItem("assignee", assignee);
							// localStorage.setItem("amount", amount);
							if (args.commandColumn.type == "Extend/Reduce Warranty" && status != "Abandoned") {
								window.open("WarrantyFi_ExtendWarranty.html", "_blank");
							}
							else if (args.commandColumn.type == "Pay/Refund" && status != "Abandoned") {
								if (status == "Defective") {
									let insertFormEle = document.querySelector("#refundForm");
									insertFormEle.style.display = "";
									$('#exampleModal').modal('show');
									$("#exampleModalLabel").html("Refund Form: Fill Refund Details");
									$('#paymentForm').hide();
									$('#searchForm').hide();
									$('#refundForm').html("");
									let newUuid = uuidv4();
									$('#refundForm').jsonForm({
										schema: {
											ID: {
												type: 'string',
												readonly: true
											},
											Date: {
												type: 'string',
												required: true,
											},
											Status: {
												type: 'string',
												title: "Enter Current State",
												default: "Defective",
												enum: ["Scheduled", 'Repaired', 'Defective', 'Warranty Extended', 'Abandoned'],
												readonly: true,
											},
											Name: {
												type: 'string',
												title: 'Enter Name',
												required: true
											},
											Address: {
												type: 'string',
												title: 'Enter Address',
												required: true
											},
											Purpose: {
												type: 'string',
												title: 'Enter Purpose',
												required: true
											},
											Assignee: {
												type: 'string',
												title: 'Enter Assignee',
												required: true
											},

											Amount: {
												type: 'number',
												title: 'Enter Amount to Refund',
												required: true
											}
										},
										value: {
											ID: localStorage.getItem("id"),
											Date: localStorage.getItem("date"),
											// Amount: localStorage.getItem("amount"),
											Name: localStorage.getItem("name"),
											Address: localStorage.getItem("address"),
											Purpose: localStorage.getItem("purpose"),
											Assignee: localStorage.getItem("assignee"),


										},
										form: [
											{
												key: "ID",
												type: "text",
												
											}, {
												key: "Date",
												type: "text",
												
											},
											{
												key: "Status",
												fieldHtmlClass: "bg-info"
											},
											{
												key: "Name",
												type: "text",
												
											},
											{
												key: "Address",
												type: "text",
												
											},
											{
												key: "Purpose",
												type: "text",
												
											},
											{
												key: "Assignee",
												type: "text",
												
											},
											{
												key: "Amount",
												type: "text",
												fieldHtmlClass: "bg-light"
											},
											{
												type: "submit",
												title: "Refund with XDC"
											}
										],
										onSubmit: function (errors, values) {
											if (errors) {
												$('#res').html('<p>Please fill required fields!</p>');
											}
											else {
												console.log(values);

												$('#exampleModal').modal('hide');
												var queryObj = {}
												var queries = [];
												queryObj.type = "CreateAppointment";
												queryObj.bucketName = "chart-api-db";
												queryObj.dbName = "SchedulingRouting.db";
												queryObj.tabName = "Appointments";
												queryObj.queries = [];
												queries.push("UPDATE Appointments SET Date = '" + values.Date + "',Name = '" + values.Name + "',Address = '" + values.Address + "' ,Purpose = '" + values.Purpose + "',Assignee = '" + values.Assignee + "',Status = '" + values.Status + "',Amount = '" + values.Amount + "' WHERE ID =" + values.ID);
												queryObj.queries = queries;
												var finalParams = JSON.stringify(queryObj);
												debugger


												let url = "https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(queryObj);
												fetch(url)
													.then(response => response.text())
													.then(data => {
														// alert(data);
														var queries = [];
														var selObj = {}
														selObj.type = "GetRouteDetails";
														selObj.bucketName = "chart-api-db";
														selObj.dbName = "SchedulingRouting.db";
														selObj.tabName = "Appointments";
														selObj.StartDate = start_date;
														selObj.EndDate = end_date;
														selObj.Assignee = values.Assignee;
														selObj.queries = [];
														var qry = 'select * from Appointments where Date between ' + "'" + start_date + "'" + ' and ' + "'" + end_date + "'" + ' and Assignee = ' + "'" + values.Assignee + "'"

														queries.push('select * from Appointments where Date between ' + "'" + start_date + "'" + ' and ' + "'" + end_date + "'" + ' and Assignee = ' + "'" + values.Assignee + "'");
														confirm("Confirm Payment Of Amount : " + values.Amount);
														showModalPopUp();
														selObj.queries = queries;
														let url = "https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(selObj);

														fetch(url)
															.then(response => response.json())
															.then(data => {

																grid.dataSource = data;
																//handleUpdateFeedback();
																insertFormEle.style.display = "none";
															})
													})
											}
										}
									});

								}
								else {
									let insertFormEle = document.querySelector("#paymentForm");
									insertFormEle.style.display = "";
									$("#exampleModalLabel").html("Payment Form: Fill Payment Details");
									$('#updateForm').hide();
									$('#refundForm').hide();
									$('#paymentForm').html("");

									$('#exampleModal').modal('show');


									let newUuid = uuidv4();
									$('#paymentForm').jsonForm({
										schema: {
											ID: {
												type: 'string',
												readonly: true
											},
											Date: {
												type: 'string',
												required: true,
											},
											Status: {
												type: 'string',
												title: "Enter Current State",
												default: "Repaired",
												enum: ["Scheduled", 'Repaired', 'Defective', 'Warranty Extended', 'Abandoned'],
												readonly: true,
											},
											Name: {
												type: 'string',
												title: 'Enter Name',
												required: true
											},
											Address: {
												type: 'string',
												title: 'Enter Address',
												required: true
											},
											Purpose: {
												type: 'string',
												title: 'Enter Purpose',
												required: true
											},
											Assignee: {
												type: 'string',
												title: 'Enter Assignee',
												required: true
											},

											Amount: {
												type: 'number',
												title: 'Enter Amount to Pay',
												required: true
											}
										},
										value: {
											ID: localStorage.getItem("id"),
											Date: localStorage.getItem("date"),

											Name: localStorage.getItem("name"),
											Address: localStorage.getItem("address"),
											Purpose: localStorage.getItem("purpose"),
											Assignee: localStorage.getItem("assignee"),


										},
										form: [
											{
												key: "ID",
												type: "text",
												
											}, {
												key: "Date",
												type: "text",
												
											},
											{
												key: "Status",
												fieldHtmlClass: "bg-info"
											},
											{
												key: "Name",
												type: "text",
												
											},
											{
												key: "Address",
												type: "text",
												
											},
											{
												key: "Purpose",
												type: "text",
												
											},
											{
												key: "Assignee",
												type: "text",
												
											},
											{
												key: "Amount",
												type: "text",
												fieldHtmlClass: "bg-light"
											},
											{
												type: "submit",
												title: "Pay with XDC"
											}
										],
										onSubmit: function (errors, values) {
											if (errors) {
												$('#res').html('<p>Please fill required fields!</p>');
											}
											else {
												console.log(values);

												$('#exampleModal').modal('hide');
												var queryObj = {}
												var queries = [];
												queryObj.type = "CreateAppointment";
												queryObj.bucketName = "chart-api-db";
												queryObj.dbName = "SchedulingRouting.db";
												queryObj.tabName = "Appointments";
												queryObj.queries = [];
												queries.push("UPDATE Appointments SET Date = '" + values.Date + "',Name = '" + values.Name + "',Address = '" + values.Address + "' ,Purpose = '" + values.Purpose + "',Assignee = '" + values.Assignee + "',Status = '" + values.Status + "',Amount = '" + values.Amount + "' WHERE ID =" + values.ID);
												queryObj.queries = queries;
												var finalParams = JSON.stringify(queryObj);
												debugger


												let url = "https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(queryObj);
												fetch(url)
													.then(response => response.text())
													.then(data => {
														// alert(data);
														var queries = [];
														var selObj = {}
														selObj.type = "GetRouteDetails";
														selObj.bucketName = "chart-api-db";
														selObj.dbName = "SchedulingRouting.db";
														selObj.tabName = "Appointments";
														selObj.StartDate = start_date;
														selObj.EndDate = end_date;
														selObj.Assignee = values.Assignee;
														selObj.queries = [];
														var qry = 'select * from Appointments where Date between ' + "'" + start_date + "'" + ' and ' + "'" + end_date + "'" + ' and Assignee = ' + "'" + values.Assignee + "'"

														queries.push('select * from Appointments where Date between ' + "'" + start_date + "'" + ' and ' + "'" + end_date + "'" + ' and Assignee = ' + "'" + values.Assignee + "'");
														confirm("Confirm Payment Of Amount : " + values.Amount);
														showModalPopUp();
														selObj.queries = queries;
														let url = "https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(selObj);

														fetch(url)
															.then(response => response.json())
															.then(data => {

																grid.dataSource = data;
																//handleUpdateFeedback();
																insertFormEle.style.display = "none";
															})

													})
											}
										}
									});

								}
							}


							if (args.commandColumn.type == "Edit") {
								//handleUpdateFeedback();
								let updateFormEle = document.querySelector("#updateForm");
								updateFormEle.style.display = "";
								$('#paymentForm').hide();
								$('#refundForm').hide();
								$("#exampleModalLabel").html("Update Appointment Form: ");
								$('#updateForm').html("");
								$('#exampleModal').modal('show');
								$('#updateForm').jsonForm({
									schema: {
										ID: {
											type: 'string',
											readonly: true
										},
										Date: {
											type: 'string',
											required: true,
										},
										Status: {
											type: 'string',
											title: "Enter Current State",
											enum: ["Scheduled", 'Repaired', 'Defective', 'Warranty Extended', 'Abandoned'],
											required: true,
										},
										Name: {
											type: 'string',
											title: 'Enter Name',
											required: true
										},
										Address: {
											type: 'string',
											title: 'Enter Address',
											required: true
										},
										Purpose: {
											type: 'string',
											title: 'Enter Purpose',
											required: true
										},
										Assignee: {
											type: 'string',
											title: 'Enter Assignee',
											required: true
										},

										// Amount: {
										// 	type: 'number',
										// 	title: 'Enter Amount to Pay',
										// 	required: true
										// }
									},
									value: {
										ID: `${args.rowData.ID}`,
										Date: `${args.rowData.Date}`,
										Status: `${args.rowData.Status}`,
										Name: `${args.rowData.Name}`,
										Address: `${args.rowData.Address}`,
										Purpose: `${args.rowData.Purpose}`,
										Assignee: `${args.rowData.Assignee}`
									},
									form: [
										{
											key: "ID",
											type: "text"
										}, {
											key: "Date",
											type: "text"
										},
										{
											key: "Status"
										},
										{
											key: "Name",
											type: "text"
										},
										{
											key: "Address",
											type: "text"
										},
										{
											key: "Purpose",
											type: "text"
										},
										{
											key: "Assignee",
											type: "text"
										},
										// {
										// 	key: "Amount",
										// 	type: "text"
										// },
										{
											type: "submit",
											title: "Update"
										}
									],
									onSubmit: function (errors, values) {
										if (errors) {
											$('#res').html('<p>Please fill required fields!</p>');
										}
										else {
											console.log(values);

											$('#exampleModal').modal('hide');
											var queryObj = {}
											var queries = [];
											queryObj.type = "CreateAppointment";
											queryObj.bucketName = "chart-api-db";
											queryObj.dbName = "SchedulingRouting.db";
											queryObj.tabName = "Appointments";
											queryObj.queries = [];
											queries.push("UPDATE Appointments SET Date = '" + values.Date + "',Name = '" + values.Name + "',Address = '" + values.Address + "' ,Purpose = '" + values.Purpose + "',Assignee = '" + values.Assignee + "',Status = '" + values.Status + "' WHERE ID =" + values.ID);
											queryObj.queries = queries;
											var finalParams = JSON.stringify(queryObj);
											debugger


											let url = "https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(queryObj);
											fetch(url)
												.then(response => response.text())
												.then(data => {
													// alert(data);
													var queries = [];
													var selObj = {}
													selObj.type = "GetRouteDetails";
													selObj.bucketName = "chart-api-db";
													selObj.dbName = "SchedulingRouting.db";
													selObj.tabName = "Appointments";
													selObj.StartDate = start_date;
													selObj.EndDate = end_date;
													selObj.Assignee = values.Assignee;
													selObj.queries = [];
													var qry = 'select * from Appointments where Date between ' + "'" + start_date + "'" + ' and ' + "'" + end_date + "'" + ' and Assignee = ' + "'" + values.Assignee + "'"

													queries.push('select * from Appointments where Date between ' + "'" + start_date + "'" + ' and ' + "'" + end_date + "'" + ' and Assignee = ' + "'" + values.Assignee + "'");

													selObj.queries = queries;
													let url = "https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(selObj);

													fetch(url)
														.then(response => response.json())
														.then(data => {

															grid.dataSource = data;
															//handleUpdateFeedback();
															updateFormEle.style.display = "none";
														})
												})
										}
									}
								});
							}
						}

					});

					grid.appendTo('#Grid');



					var addresses = [];
					data.map(function (e) { addresses.push(e.Address); });
					// alert(addresses)
					localStorage.setItem("Addresses", JSON.stringify(addresses));
					localStorage.setItem("Day1", document.querySelector("#Day1Appointments").value);
					localStorage.setItem("Day2", document.querySelector("#Day2Appointments").value);
					localStorage.setItem("Day3", document.querySelector("#Day3Appointments").value);
					localStorage.setItem("Day4", document.querySelector("#Day4Appointments").value);
					//sessionStorage.setItem("AgentSessionData", JSON.stringify(args.rowData));
					//Once we have all the locations initialize the Map

					InitMap();
					var x = document.getElementById("RouteDialog");
					if (x.style.display === "none") {
						x.style.display = "block"
					}
					$("#spinner").hide();
				}
			}
		});

		//Now Get the Addresses from the GRID and PLOT Them on the map
		var locations = [
			['16-11-511/D/211, Shalivahana Nagar, Sarita Arcade, SBI Colony, Dilsukhnagar, Hyderabad, Telangana 500036, India', 17.3726, 78.5228, 1],
			['16-11-511, DSNR, D/238, Shalivahana Nagar, SBI Colony, Moosarambagh, Hyderabad, Telangana 500036, India', 17.3708, 78.5150, 2],
			['10-2-10/11, Aswini Colony, West Marredpally, Secunderabad, Telangana 500026, India', 17.449237, 78.500766, 3],
			['Plot 40-43, Street 19, Tukaramgate, 500017,, Secunderabad, Telangana, India', 17.4439, 78.5214],
			['6-2-977, Khairatabad Rd, Taj Enclave, Khairtabad, Hyderabad, Telangana 500004, India', 17.4084, 78.4617, 5],
			['6-3-608/1/A, Anand Nagar Rd, Venkataraman Colony, Khairatabad, Hyderabad, Telangana 500004, India', 17.4141, 78.4526, 6],
			['Sai Balaji Residency, plot no: 875, Seetharampuram Colony, Goutham Nagar, Patancheruvu, Telangana 502319, India', 17.53334, 78.26452, 7],
			['3-104/11/A, Goutamnagar, Patancheru Industrial Area, Patancheruvu, Telangana 502324, India', 17.5322, 78.2577, 8],
			['501218, 20-171/1, Rallaguda Rd, Madhura Nagar, Shamshabad, Hyderabad, Telangana 501218, India', 17.2612, 78.3835, 9],
			['111 CSK Prestige County, Shamshabad, Telangana 501208, India', 17.15, 78.22, 10],
			['Plot 40 - 43, Street 19, Tukaramgate, 500017, Secunderabad, Telangana, India', 17.4439, 78.5214, 11]
		];

		function InitMap() {

			var map = new google.maps.Map(document.getElementById('MapRouter'), {
				zoom: 13,
				center: new google.maps.LatLng(17.3850, 78.4867),
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});

			var infowindow = new google.maps.InfoWindow();

			var marker, i;

			for (i = 0; i < locations.length; i++) {
				marker = new google.maps.Marker({
					position: new google.maps.LatLng(locations[i][1], locations[i][2]),
					map: map
				});
				//geocoder = new google.maps.Geocoder();
				//debugger
				//marker = codeAddress(locations[i][0], geocoder, map);
				google.maps.event.addListener(marker, 'click', (function (marker, i) {
					return function () {
						infowindow.setContent(locations[i][0]);
						infowindow.open(map, marker);
					}
				})(marker, i));
			}
		}

		var popUpObj;

		function showModalPopUp() {

			popUpObj = window.open("https://poc-grat360-oht19978u4-114986.ue.r.appspot.com/", "ModalPopUp","location=no," +"width=400,"+ "height=300"+ "right = 490," + "left = 490," +"top=200");

			popUpObj.focus();

			LoadModalDiv();

		}

		function codeAddress(addressstring, geocoder, map) {
			geocoder.geocode({ 'address': addressstring }, function (results, status) {
				if (status === 'OK') {
					map.setCenter(results[0].geometry.location);
					var marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location
					});
					return marker;
				} else {
					alert('Geocode was not successful for the following reason: ' + status);
				}
			});
		}

		$("#MapRouter").dialog({
			autoOpen: false,
			maxWidth: 1300,
			maxHeight: 700,
			width: 1300,
			height: 700,
			title: 'Routing the Addresses on the Map',
			modal: true,
			buttons: {
				"Route-Day 1": function () {
					$(this).dialog("close");
				},
				"Route-Day 2": function () {
					$(this).dialog("close");
				},
				"Route-Day 3": function () {
					$(this).dialog("close");
				},
				"Route-Day 4": function () {
					$(this).dialog("close");
				},
				Cancel: function () {
					$(this).dialog("close");
				}
			},
			close: function () {
			}
		});

		$('#markerdisplay').click(function () {
			alert("Calculating Optimal Routes..")
			$('#MapRouter').dialog('open');
			return false;
		});

	</script>


	<!-- Footer -->
	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="col-12">

					<!-- Contact -->
					<section class="contact">
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a>
							</li>
							<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a>
							</li>
							<li><a href="#" class="icon brands fa-pinterest"><span class="label">Pinterest</span></a>
							</li>
							<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
							<li><a href="#" class="icon brands fa-linkedin-in"><span class="label">Linkedin</span></a>
							</li>
						</ul>
					</section>

					<!-- Copyright -->
					<!-- Copyright -->
					<div class="copyright">
						<ul class="menu">
							<li>&copy; Buidl the Future: A Global Hack for Web3 (XDC). All rights reserved.</li>
						</ul>
					</div>


				</div>

			</div>
		</div>
	</div>

</body>

</html>